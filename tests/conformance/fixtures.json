{
  "description": "Cross-language conformance fixtures for jsonschema-llm WASI wrappers",
  "version": "1.0",
  "suites": {
    "convert": {
      "description": "Convert operation test cases",
      "fixtures": [
        {
          "id": "convert_simple_object",
          "description": "Simple object schema converts with expected keys",
          "input": {
            "schema": {
              "type": "object",
              "properties": {
                "name": { "type": "string" },
                "age": { "type": "integer", "minimum": 0 }
              },
              "required": ["name", "age"]
            },
            "options": {}
          },
          "expected": {
            "has_keys": ["apiVersion", "schema", "codec"],
            "apiVersion": "1.0",
            "schema_has_properties": true,
            "codec_has_schema_uri": true
          }
        },
        {
          "id": "convert_nested_object",
          "description": "Nested object schema with arrays converts correctly",
          "input": {
            "schema": {
              "type": "object",
              "properties": {
                "user": {
                  "type": "object",
                  "properties": {
                    "name": { "type": "string" },
                    "emails": { "type": "array", "items": { "type": "string" } }
                  },
                  "required": ["name"]
                },
                "role": { "type": "string", "enum": ["admin", "user", "guest"] }
              },
              "required": ["user", "role"]
            },
            "options": {}
          },
          "expected": {
            "has_keys": ["apiVersion", "schema", "codec"],
            "apiVersion": "1.0"
          }
        },
        {
          "id": "convert_with_max_depth",
          "description": "Non-default max-depth option is accepted",
          "input": {
            "schema": {
              "type": "object",
              "properties": {
                "x": { "type": "string" }
              }
            },
            "options": { "max-depth": 5 }
          },
          "expected": {
            "has_keys": ["apiVersion", "schema", "codec"],
            "apiVersion": "1.0"
          }
        },
        {
          "id": "convert_with_recursion_limit",
          "description": "Non-default recursion-limit option is accepted",
          "input": {
            "schema": {
              "type": "object",
              "properties": {
                "x": { "type": "string" }
              }
            },
            "options": { "recursion-limit": 2 }
          },
          "expected": {
            "has_keys": ["apiVersion", "schema", "codec"],
            "apiVersion": "1.0"
          }
        },
        {
          "id": "convert_with_target",
          "description": "Target provider option (openai-strict) is accepted",
          "input": {
            "schema": {
              "type": "object",
              "properties": {
                "x": { "type": "string" }
              }
            },
            "options": { "target": "openai-strict" }
          },
          "expected": {
            "has_keys": ["apiVersion", "schema", "codec"],
            "apiVersion": "1.0"
          }
        },
        {
          "id": "convert_provider_compat_errors",
          "description": "Schema that triggers provider compat errors includes providerCompatErrors",
          "input": {
            "schema": {
              "type": "object",
              "properties": {
                "data": {
                  "type": "object",
                  "additionalProperties": { "type": "string" }
                }
              }
            },
            "options": { "target": "openai-strict" }
          },
          "expected": {
            "has_keys": ["apiVersion", "schema", "codec"],
            "apiVersion": "1.0"
          }
        },
        {
          "id": "convert_error_invalid_json",
          "description": "Invalid JSON input produces structured error",
          "input": {
            "schema_raw": "NOT VALID JSON",
            "options": {}
          },
          "expected": {
            "is_error": true,
            "error_has_keys": ["code", "message"],
            "error_code": "json_parse_error"
          }
        },
        {
          "id": "convert_empty_object",
          "description": "Empty object schema converts successfully",
          "input": {
            "schema": { "type": "object" },
            "options": {}
          },
          "expected": {
            "has_keys": ["apiVersion", "schema", "codec"],
            "apiVersion": "1.0"
          }
        }
      ]
    },
    "roundtrip": {
      "description": "Convert + rehydrate roundtrip test cases",
      "fixtures": [
        {
          "id": "roundtrip_simple",
          "description": "Simple object roundtrips with data preservation",
          "input": {
            "schema": {
              "type": "object",
              "properties": {
                "name": { "type": "string" },
                "age": { "type": "integer", "minimum": 0 }
              },
              "required": ["name", "age"]
            },
            "options": {},
            "data": { "name": "Ada", "age": 36 }
          },
          "expected": {
            "has_keys": ["apiVersion", "data"],
            "apiVersion": "1.0",
            "data": { "name": "Ada", "age": 36 },
            "warnings_is_array": true
          }
        },
        {
          "id": "roundtrip_nested",
          "description": "Nested objects with arrays roundtrip correctly",
          "input": {
            "schema": {
              "type": "object",
              "properties": {
                "user": {
                  "type": "object",
                  "properties": {
                    "name": { "type": "string" },
                    "tags": { "type": "array", "items": { "type": "string" } }
                  },
                  "required": ["name"]
                }
              },
              "required": ["user"]
            },
            "options": {},
            "data": {
              "user": { "name": "Ada", "tags": ["pioneer", "mathematician"] }
            }
          },
          "expected": {
            "has_keys": ["apiVersion", "data"],
            "apiVersion": "1.0",
            "data_user_name": "Ada",
            "warnings_is_array": true
          }
        },
        {
          "id": "roundtrip_with_options",
          "description": "Roundtrip works with non-default conversion options",
          "input": {
            "schema": {
              "type": "object",
              "properties": {
                "value": { "type": "number" }
              },
              "required": ["value"]
            },
            "options": { "max-depth": 10 },
            "data": { "value": 42.5 }
          },
          "expected": {
            "has_keys": ["apiVersion", "data"],
            "data_value": 42.5,
            "warnings_is_array": true
          }
        }
      ]
    },
    "rehydrate_error": {
      "description": "Rehydrate error cases",
      "fixtures": [
        {
          "id": "rehydrate_invalid_codec",
          "description": "Invalid codec JSON produces structured error",
          "input": {
            "data": { "x": "hello" },
            "codec_raw": "NOT VALID JSON",
            "schema": { "type": "object" }
          },
          "expected": {
            "is_error": true,
            "error_has_keys": ["code", "message"]
          }
        }
      ]
    },
    "list_components": {
      "description": "list_components operation test cases",
      "fixtures": [
        {
          "id": "list_components_with_defs",
          "description": "Schema with $defs returns sorted component pointers",
          "input": {
            "schema": {
              "$defs": {
                "Pet": { "type": "object", "properties": { "name": { "type": "string" } } },
                "Tag": { "type": "string" },
                "Address": { "type": "object", "properties": { "city": { "type": "string" } } }
              }
            }
          },
          "expected": {
            "has_keys": ["apiVersion", "components"],
            "apiVersion": "1.0",
            "components": ["#/$defs/Address", "#/$defs/Pet", "#/$defs/Tag"]
          }
        },
        {
          "id": "list_components_empty_schema",
          "description": "Schema without $defs returns empty components list",
          "input": {
            "schema": {
              "type": "object",
              "properties": { "x": { "type": "string" } }
            }
          },
          "expected": {
            "has_keys": ["apiVersion", "components"],
            "apiVersion": "1.0",
            "components": []
          }
        },
        {
          "id": "list_components_error_invalid_json",
          "description": "Invalid JSON input produces structured error",
          "input": {
            "schema_raw": "NOT VALID JSON"
          },
          "expected": {
            "is_error": true,
            "error_has_keys": ["code", "message"]
          }
        }
      ]
    },
    "extract_component": {
      "description": "extract_component operation test cases",
      "fixtures": [
        {
          "id": "extract_simple_def",
          "description": "Extract a simple $def produces self-contained sub-schema",
          "input": {
            "schema": {
              "$defs": {
                "Pet": {
                  "type": "object",
                  "properties": {
                    "name": { "type": "string" },
                    "age": { "type": "integer" }
                  },
                  "required": ["name"]
                },
                "Tag": { "type": "string" }
              }
            },
            "pointer": "#/$defs/Pet",
            "options": {}
          },
          "expected": {
            "has_keys": ["apiVersion", "schema", "pointer", "dependencyCount"],
            "apiVersion": "1.0",
            "pointer": "#/$defs/Pet",
            "schema_is_object": true,
            "dependency_count": 0
          }
        },
        {
          "id": "extract_with_internal_ref",
          "description": "Extract a $def that references another $def resolves dependencies",
          "input": {
            "schema": {
              "$defs": {
                "Owner": {
                  "type": "object",
                  "properties": {
                    "name": { "type": "string" },
                    "pet": { "$ref": "#/$defs/Pet" }
                  }
                },
                "Pet": {
                  "type": "object",
                  "properties": {
                    "name": { "type": "string" }
                  }
                }
              }
            },
            "pointer": "#/$defs/Owner",
            "options": {}
          },
          "expected": {
            "has_keys": ["apiVersion", "schema", "pointer", "dependencyCount"],
            "apiVersion": "1.0",
            "pointer": "#/$defs/Owner",
            "schema_is_object": true,
            "dependency_count_gte": 1
          }
        },
        {
          "id": "extract_missing_pointer",
          "description": "Extracting a non-existent pointer produces error",
          "input": {
            "schema": {
              "$defs": {
                "Foo": { "type": "string" }
              }
            },
            "pointer": "#/$defs/DoesNotExist",
            "options": {}
          },
          "expected": {
            "is_error": true,
            "error_has_keys": ["code", "message"]
          }
        }
      ]
    },
    "convert_all_components": {
      "description": "convert_all_components operation test cases",
      "fixtures": [
        {
          "id": "convert_all_with_defs",
          "description": "Schema with $defs produces full + per-component results",
          "input": {
            "schema": {
              "$defs": {
                "A": { "type": "string" },
                "B": { "type": "integer" }
              }
            },
            "convert_options": {},
            "extract_options": {}
          },
          "expected": {
            "has_keys": ["apiVersion", "full", "components"],
            "apiVersion": "1.0",
            "full_is_object": true,
            "components_count": 2
          }
        },
        {
          "id": "convert_all_empty_schema",
          "description": "Schema without $defs returns empty components",
          "input": {
            "schema": {
              "type": "object",
              "properties": { "x": { "type": "string" } }
            },
            "convert_options": {},
            "extract_options": {}
          },
          "expected": {
            "has_keys": ["apiVersion", "full", "components"],
            "apiVersion": "1.0",
            "full_is_object": true,
            "components_count": 0
          }
        },
        {
          "id": "convert_all_error_invalid_json",
          "description": "Invalid JSON input produces structured error",
          "input": {
            "schema_raw": "NOT VALID JSON",
            "convert_options": {},
            "extract_options": {}
          },
          "expected": {
            "is_error": true,
            "error_has_keys": ["code", "message"]
          }
        }
      ]
    }
  }
}
