{
  "$comment": "https://spec.openapis.org/arazzo/v1.0#step-object'",
  "$defs": {
    "criterion-expression-type-object": {
      "$comment": "https://spec.openapis.org/arazzo/v1.0#criterion-expression-type-object",
      "$ref": "#/$defs/specification-extensions",
      "allOf": [
        {
          "if": {
            "properties": {
              "type": {
                "const": "jsonpath"
              }
            },
            "required": [
              "type"
            ]
          },
          "then": {
            "properties": {
              "version": {
                "const": "draft-goessner-dispatch-jsonpath-00"
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "const": "xpath"
              }
            },
            "required": [
              "type"
            ]
          },
          "then": {
            "properties": {
              "version": {
                "enum": [
                  "xpath-10",
                  "xpath-20",
                  "xpath-30"
                ]
              }
            }
          }
        }
      ],
      "description": "An object used to describe the type and version of an expression used within a Criterion Object",
      "properties": {
        "type": {
          "description": "The type of condition to be applied",
          "enum": [
            "jsonpath",
            "xpath"
          ]
        },
        "version": {
          "description": "A short hand string representing the version of the expression type",
          "type": "string"
        }
      },
      "required": [
        "type",
        "version"
      ],
      "type": "object"
    },
    "criterion-object": {
      "$comment": "https://spec.openapis.org/arazzo/v1.0#criterion-object",
      "$ref": "#/$defs/specification-extensions",
      "anyOf": [
        {
          "properties": {
            "type": {
              "default": "simple",
              "description": "The type of condition to be applied",
              "enum": [
                "simple",
                "regex",
                "jsonpath",
                "xpath"
              ]
            }
          },
          "type": "object"
        },
        {
          "$ref": "#/$defs/criterion-expression-type-object"
        }
      ],
      "dependentRequired": {
        "type": [
          "context"
        ]
      },
      "description": "An object used to specify the context, conditions, and condition types that can be used to prove or satisfy assertions specified in Step Object successCriteria, Success Action Object criteria, and Failure Action Object criteria",
      "properties": {
        "condition": {
          "description": "The condition to apply",
          "type": "string"
        },
        "context": {
          "description": "A runtime expression used to set the context for the condition to be applied on",
          "type": "string"
        }
      },
      "required": [
        "condition"
      ],
      "type": "object",
      "unevaluatedProperties": false
    },
    "failure-action-object": {
      "$comment": "https://spec.openapis.org/arazzo/v1.0#failure-action-object",
      "$ref": "#/$defs/specification-extensions",
      "allOf": [
        {
          "if": {
            "properties": {
              "type": {
                "enum": [
                  "goto",
                  "retry"
                ]
              }
            }
          },
          "then": {
            "oneOf": [
              {
                "required": [
                  "workflowId"
                ]
              },
              {
                "required": [
                  "stepId"
                ]
              }
            ]
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "const": "retry"
              }
            }
          },
          "then": {
            "required": [
              "retryAfter"
            ]
          }
        }
      ],
      "description": "A single failure action which describes an action to take upon failure of a workflow step",
      "properties": {
        "criteria": {
          "description": "A list of assertions to determine if this action SHALL be executed",
          "items": {
            "$ref": "#/$defs/criterion-object"
          },
          "type": "array",
          "uniqueItems": true
        },
        "name": {
          "description": "The name of the failure action",
          "type": "string"
        },
        "retryAfter": {
          "description": "A non-negative decimal indicating the seconds to delay after the step failure before another attempt SHALL be made",
          "minimum": 0,
          "type": "number"
        },
        "retryLimit": {
          "description": "A non-negative integer indicating how many attempts to retry the step MAY be attempted before failing the overall step",
          "minimum": 0,
          "type": "integer"
        },
        "stepId": {
          "$ref": "#/$defs/stepId",
          "description": "The stepId to transfer to upon failure of the step"
        },
        "type": {
          "description": "The type of action to take",
          "enum": [
            "end",
            "goto",
            "retry"
          ]
        },
        "workflowId": {
          "$ref": "#/$defs/workflowId",
          "description": "The workflowId referencing an existing workflow within the Arazzo description to transfer to upon failure of the step"
        }
      },
      "required": [
        "name",
        "type"
      ],
      "type": "object",
      "unevaluatedProperties": false
    },
    "parameter-object": {
      "$comment": "https://spec.openapis.org/arazzo/v1.0#parameter-object",
      "$ref": "#/$defs/specification-extensions",
      "description": "Describes a single step parameter",
      "properties": {
        "in": {
          "description": "The named location of the parameter",
          "enum": [
            "path",
            "query",
            "header",
            "cookie"
          ]
        },
        "name": {
          "description": "The name of the parameter",
          "type": "string"
        },
        "value": {
          "description": "The value to pass in the parameter",
          "type": [
            "string",
            "boolean",
            "object",
            "array",
            "number",
            "null"
          ]
        }
      },
      "required": [
        "name",
        "value"
      ],
      "type": "object",
      "unevaluatedProperties": false
    },
    "payload-replacement-object": {
      "$comment": "https://spec.openapis.org/arazzo/v1.0#payload-replacement-object",
      "$ref": "#/$defs/specification-extensions",
      "description": "Describes a location within a payload (e.g., a request body) and a value to set within the location",
      "properties": {
        "target": {
          "description": "A JSON Pointer or XPath Expression which MUST be resolved against the request body",
          "type": "string"
        },
        "value": {
          "description": "The value set within the target location",
          "type": "string"
        }
      },
      "required": [
        "target",
        "value"
      ],
      "type": "object",
      "unevaluatedProperties": false
    },
    "request-body-object": {
      "$comment": "https://spec.openapis.org/arazzo/v1.0#request-body-object",
      "$ref": "#/$defs/specification-extensions",
      "description": "The request body to pass to an operation as referenced by operationId or operationPath",
      "properties": {
        "contentType": {
          "description": "The Content-Type for the request content",
          "type": "string"
        },
        "payload": true,
        "replacements": {
          "description": "A list of locations and values to set within a payload",
          "items": {
            "$ref": "#/$defs/payload-replacement-object"
          },
          "type": "array",
          "uniqueItems": true
        }
      },
      "type": "object",
      "unevaluatedProperties": false
    },
    "reusable-object": {
      "$comment": "https://spec.openapis.org/arazzo/v1.0#reusable-object",
      "description": "A simple object to allow referencing of objects contained within the Components Object",
      "properties": {
        "reference": {
          "description": "A runtime expression used to reference the desired object",
          "type": "string"
        },
        "value": {
          "description": "Sets a value of the referenced parameter",
          "type": [
            "string",
            "boolean",
            "object",
            "array",
            "number",
            "null"
          ]
        }
      },
      "required": [
        "reference"
      ],
      "type": "object",
      "unevaluatedProperties": false
    },
    "specification-extensions": {
      "$comment": "https://spec.openapis.org/arazzo/v1.0#specification-extensions",
      "description": "While the Arazzo Specification tries to accommodate most use cases, additional data can be added to extend the specification at certain points",
      "patternProperties": {
        "^x-": true
      }
    },
    "stepId": {
      "$anchor": "stepId",
      "description": "Unique string to represent the step",
      "type": "string"
    },
    "success-action-object": {
      "$comment": "https://spec.openapis.org/arazzo/v1.0#success-action-object",
      "$ref": "#/$defs/specification-extensions",
      "allOf": [
        {
          "if": {
            "properties": {
              "type": {
                "const": "goto"
              }
            }
          },
          "then": {
            "oneOf": [
              {
                "required": [
                  "workflowId"
                ]
              },
              {
                "required": [
                  "stepId"
                ]
              }
            ]
          }
        }
      ],
      "description": "A single success action which describes an action to take upon success of a workflow step",
      "properties": {
        "criteria": {
          "description": "A list of assertions to determine if this action SHALL be executed",
          "items": {
            "$ref": "#/$defs/criterion-object"
          },
          "minItems": 1,
          "type": "array",
          "uniqueItems": true
        },
        "name": {
          "description": "The name of the success action",
          "type": "string"
        },
        "stepId": {
          "$ref": "#/$defs/stepId",
          "description": "The stepId to transfer to upon success of the step"
        },
        "type": {
          "description": "The type of action to take",
          "enum": [
            "end",
            "goto"
          ]
        },
        "workflowId": {
          "$ref": "#/$defs/workflowId",
          "description": "The workflowId referencing an existing workflow within the Arazzo description to transfer to upon success of the step"
        }
      },
      "required": [
        "name",
        "type"
      ],
      "type": "object",
      "unevaluatedProperties": false
    },
    "workflowId": {
      "$anchor": "workflowId",
      "description": "Unique string to represent the workflow",
      "type": "string"
    }
  },
  "$ref": "#/$defs/specification-extensions",
  "allOf": [
    {
      "if": {
        "oneOf": [
          {
            "required": [
              "operationPath"
            ]
          },
          {
            "required": [
              "operationId"
            ]
          }
        ]
      },
      "then": {
        "properties": {
          "parameters": {
            "items": {
              "oneOf": [
                {
                  "$ref": "#/$defs/reusable-object"
                },
                {
                  "$ref": "#/$defs/parameter-object",
                  "required": [
                    "in"
                  ]
                }
              ]
            }
          }
        }
      }
    },
    {
      "if": {
        "required": [
          "workflowId"
        ]
      },
      "then": {
        "properties": {
          "parameters": {
            "items": {
              "oneOf": [
                {
                  "$ref": "#/$defs/parameter-object"
                },
                {
                  "$ref": "#/$defs/reusable-object"
                }
              ]
            }
          }
        }
      }
    }
  ],
  "description": "Describes a single workflow step which MAY be a call to an API operation (OpenAPI Operation Object or another Workflow Object)",
  "oneOf": [
    {
      "required": [
        "operationId"
      ]
    },
    {
      "required": [
        "operationPath"
      ]
    },
    {
      "required": [
        "workflowId"
      ]
    }
  ],
  "properties": {
    "description": {
      "description": "A description of the step. CommonMark syntax MAY be used for rich text representation",
      "type": "string"
    },
    "onFailure": {
      "description": "An array of failure action objects that specify what to do upon step failure",
      "items": {
        "oneOf": [
          {
            "$ref": "#/$defs/failure-action-object"
          },
          {
            "$ref": "#/$defs/reusable-object"
          }
        ]
      },
      "type": "array",
      "uniqueItems": true
    },
    "onSuccess": {
      "description": "An array of success action objects that specify what to do upon step success",
      "items": {
        "oneOf": [
          {
            "$ref": "#/$defs/success-action-object"
          },
          {
            "$ref": "#/$defs/reusable-object"
          }
        ]
      },
      "type": "array",
      "uniqueItems": true
    },
    "operationId": {
      "description": "The name of an existing, resolvable operation, as defined with a unique operationId and existing within one of the sourceDescriptions",
      "type": "string"
    },
    "operationPath": {
      "description": "A reference to a Source combined with a JSON Pointer to reference an operation",
      "type": "string"
    },
    "outputs": {
      "description": "A map between a friendly name and a dynamic output value defined using a runtime expression",
      "patternProperties": {
        "^[a-zA-Z0-9\\.\\-_]+$": {
          "type": "string"
        }
      },
      "type": "object"
    },
    "parameters": {
      "description": "A list of parameters that MUST be passed to an operation or workflow as referenced by operationId, operationPath, or workflowId",
      "items": true,
      "type": "array",
      "uniqueItems": true
    },
    "requestBody": {
      "$ref": "#/$defs/request-body-object"
    },
    "stepId": {
      "$anchor": "stepId",
      "description": "Unique string to represent the step",
      "type": "string"
    },
    "successCriteria": {
      "description": "A list of assertions to determine the success of the step",
      "items": {
        "$ref": "#/$defs/criterion-object"
      },
      "minItems": 1,
      "type": "array",
      "uniqueItems": true
    },
    "workflowId": {
      "$ref": "#/$defs/workflowId",
      "description": "The workflowId referencing an existing workflow within the Arazzo description"
    }
  },
  "required": [
    "stepId"
  ],
  "type": "object",
  "unevaluatedProperties": false
}
